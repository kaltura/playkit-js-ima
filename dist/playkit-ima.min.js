!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("playkit-js")):"function"==typeof define&&define.amd?define(["playkit-js"],e):"object"==typeof exports?exports.PlaykitJsIma=e(require("playkit-js")):t.PlaykitJsIma=e(t.Playkit)}(this,function(t){return function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={LOADING:"loading",LOADED:"loaded",PLAYING:"playing",PAUSED:"paused",IDLE:"idle",DONE:"done"};e.default=i},function(e,n){e.exports=t},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function t(e,n,i){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(void 0===s){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(i)},d=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(3),l=i(u),h=n(4),c=i(h),f=n(0),p=i(f),g=n(1),_=function(t){function e(t,n,i){s(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,g.Utils.String.capitlize(t),n,i));return a._stateMachine=new c.default(a),a._intervalTimer=null,a._videoLastCurrentTime=null,a._adsManager=null,a._contentComplete=!1,a._contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},a._addBindings(),a._init(),a}return a(e,t),d(e,null,[{key:"isValid",value:function(){return!0}}]),d(e,[{key:"playAdNow",value:function(t){o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateConfig",this).call(this,{adTagUrl:t}),this.loadPromise=g.Utils.Object.defer(),this.destroy(),this._addBindings(),this._initAdsLoader(),this._requestAds(),this.loadPromise.then(this._startAdsManager.bind(this))}},{key:"skipAd",value:function(){this.logger.debug("Skip ad"),this._adsManager&&(this._adsManager.getAdSkippableState()?this._adsManager.skip():this.config.skipSupport&&this._adsManager.stop())}},{key:"resumeAd",value:function(){return this.logger.debug("Resume ad"),this._nextPromise=g.Utils.Object.defer(),this._adsManager.resume(),this._nextPromise}},{key:"pauseAd",value:function(){return this.logger.debug("Pause ad"),this._nextPromise=g.Utils.Object.defer(),this._adsManager.pause(),this._nextPromise}},{key:"updateConfig",value:function(t){o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateConfig",this).call(this,t),t.adTagUrl&&this._stateMachine.is(p.default.LOADING)&&this._requestAds()}},{key:"getStateMachine",value:function(){return this._stateMachine}},{key:"getMiddlewareImpl",value:function(){return new l.default(this)}},{key:"destroy",value:function(){this.logger.debug("destroy"),this.eventManager.destroy(),this._stopAdInterval(),this._hideAdsContainer(),this._adsManager&&this._adsManager.destroy(),this._adsLoader&&this._adsLoader.contentComplete(),this._adsManager=null,this._adsLoader=null,this._contentComplete=!1,this._intervalTimer=null,this._videoLastCurrentTime=null,this._contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0}}},{key:"initialUserAction",value:function(){try{this.logger.debug("Initial user action"),this._nextPromise=g.Utils.Object.defer(),this._adDisplayContainer.initialize(),this._startAdsManager()}catch(t){this.logger.error(t),this.destroy()}return this._nextPromise}},{key:"_startAdsManager",value:function(){var t=this,e=this._getPlayerViewSize();this._adsManager.isCustomPlaybackUsed()?(this.logger.debug("Waiting for loadedmetada event"),this.eventManager.listen(this.player,this.player.Event.LOADED_METADATA,function(){t.logger.debug("Loadedmetada event raised: start ads manager"),t.eventManager.unlisten(t.player,t.player.Event.LOADED_METADATA),t._adsManager.init(e.width,e.height,t._sdk.ViewMode.NORMAL),t._adsManager.start()}),this.logger.debug("Load player"),this.player.load()):(this.logger.debug("Start ads manager"),this._adsManager.init(e.width,e.height,this._sdk.ViewMode.NORMAL),this._adsManager.start())}},{key:"_addBindings",value:function(){this.eventManager.listen(window,"resize",this._resizeAd.bind(this)),this.eventManager.listen(this.player.getVideoElement(),"resize",this._resizeAd.bind(this)),this.eventManager.listen(this.player,this.player.Event.LOADED_METADATA,this._onLoadedMetadata.bind(this)),this.eventManager.listen(this.player,this.player.Event.TIME_UPDATE,this._onMediaTimeUpdate.bind(this)),this.eventManager.listen(this.player,this.player.Event.SEEKING,this._onMediaSeeking.bind(this)),this.eventManager.listen(this.player,this.player.Event.SEEKED,this._onMediaSeeked.bind(this)),this.eventManager.listen(this.player,this.player.Event.VOLUME_CHANGE,this._syncPlayerVolume.bind(this))}},{key:"_init",value:function(){var t=this;this.loadPromise=g.Utils.Object.defer(),(window.google&&window.google.ima?Promise.resolve():g.Utils.Dom.loadScriptAsync(this.config.debug?e.IMA_SDK_DEBUG_LIB_URL:e.IMA_SDK_LIB_URL)).then(function(){t._sdk=window.google.ima,t.logger.debug("IMA SDK version: "+t._sdk.VERSION),t._initImaSettings(),t._initAdsContainer(),t._initAdsLoader(),t._requestAds()}).catch(function(e){t.loadPromise.reject(e)})}},{key:"_initImaSettings",value:function(){this._sdk.settings.setPlayerType(g.PLAYER_NAME),this._sdk.settings.setPlayerVersion(g.VERSION),this._sdk.settings.setVpaidAllowed(!0),this._sdk.settings.setVpaidMode(this._sdk.ImaSdkSettings.VpaidMode.ENABLED),this._sdk.settings.setDisableCustomPlaybackForIOS10Plus(!0)}},{key:"_initAdsContainer",value:function(){this.logger.debug("Init ads container");var t=g.Utils.Dom.getElementById("ads-container");if(t)this._adsContainerDiv=t;else{var e=this.player.getView();this._adsContainerDiv=g.Utils.Dom.createElement("div"),this._adsContainerDiv.id="ads-container"+e.id,this._adsContainerDiv.style.position="absolute",this._adsContainerDiv.style.top="0px",g.Utils.Dom.appendChild(e,this._adsContainerDiv)}this._adDisplayContainer=new this._sdk.AdDisplayContainer(this._adsContainerDiv,this.player.getVideoElement())}},{key:"_initAdsLoader",value:function(){var t=this;this.logger.debug("Init ads loader"),this._adsLoader=new this._sdk.AdsLoader(this._adDisplayContainer),this._adsLoader.addEventListener(this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this._onAdsManagerLoaded.bind(this)),this._adsLoader.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR,function(e){return t._stateMachine.aderror(e)})}},{key:"_requestAds",value:function(){if(this.config.adTagUrl||this.config.adsResponse){this.logger.debug("Request ads");var t=new this._sdk.AdsRequest;this.config.adTagUrl?t.adTagUrl=this.config.adTagUrl:t.adsResponse=this.config.adsResponse;var e=this._getPlayerViewSize();t.linearAdSlotWidth=e.width,t.linearAdSlotHeight=e.height,t.nonLinearAdSlotWidth=e.width,t.nonLinearAdSlotHeight=e.height/3,this._adsLoader.requestAds(t)}else this.logger.warn("Missing ad tag url: create plugin without requesting ads")}},{key:"_resizeAd",value:function(){if(this._sdk&&this._adsManager){var t=this._getPlayerViewSize();this._adsManager.resize(t.width,t.height,this._sdk.ViewMode.NORMAL)}}},{key:"_getPlayerViewSize",value:function(){var t=this.player.getView();return{width:parseInt(getComputedStyle(t).width,10),height:parseInt(getComputedStyle(t).height,10)}}},{key:"_onLoadedMetadata",value:function(){this._contentPlayheadTracker.duration=this.player.duration}},{key:"_onMediaTimeUpdate",value:function(){this._contentPlayheadTracker.seeking||(this._contentPlayheadTracker.previousTime=this._contentPlayheadTracker.currentTime,this._contentPlayheadTracker.currentTime=this.player.currentTime)}},{key:"_onMediaSeeking",value:function(){this._contentPlayheadTracker.seeking=!0}},{key:"_onMediaSeeked",value:function(){this._contentPlayheadTracker.seeking=!1}},{key:"_setVideoEndedCallbackEnabled",value:function(t){t?this.eventManager.listen(this.player,this.player.Event.ENDED,this._onMediaEnded.bind(this)):this.eventManager.unlisten(this.player,this.player.Event.ENDED)}},{key:"_maybeSaveVideoCurrentTime",value:function(){this._adsManager.isCustomPlaybackUsed()&&this.player.currentTime&&this.player.currentTime>0&&(this.logger.debug("Custom playback used: save current time before ads",this.player.currentTime),this._videoLastCurrentTime=this.player.currentTime)}},{key:"_maybeSetVideoCurrentTime",value:function(){this._videoLastCurrentTime&&(this.logger.debug("Custom playback used: set current time after ads",this.player.currentTime),this.player.currentTime=this._videoLastCurrentTime,this._videoLastCurrentTime=null)}},{key:"_onMediaEnded",value:function(){this.logger.debug("Media ended"),this._adsLoader.contentComplete(),this._contentComplete=!0}},{key:"_showAdsContainer",value:function(){this._adsContainerDiv&&(this._adsContainerDiv.style.display="")}},{key:"_hideAdsContainer",value:function(){this._adsContainerDiv&&(this._adsContainerDiv.style.display="none")}},{key:"_onAdsManagerLoaded",value:function(t){var e=this;this.logger.debug("Ads manager loaded");var n=new this._sdk.AdsRenderingSettings;Object.keys(this.config.adsRenderingSettings).forEach(function(t){n[t]&&(n[t]=e.config.adsRenderingSettings[t])}),this._adsManager=t.getAdsManager(this._contentPlayheadTracker,n),this._attachAdsManagerListeners(),this._syncPlayerVolume(),this._stateMachine.loaded(),this.loadPromise.resolve()}},{key:"_attachAdsManagerListeners",value:function(){var t=this;this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(e){return t._stateMachine.adbreakstart(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOADED,function(e){return t._stateMachine.adloaded(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.STARTED,function(e){return t._stateMachine.adstarted(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.PAUSED,function(e){return t._stateMachine.adpaused(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.RESUMED,function(e){return t._stateMachine.adresumed(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.FIRST_QUARTILE,function(e){return t._stateMachine.adfirstquartile(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.MIDPOINT,function(e){return t._stateMachine.admidpoint(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.THIRD_QUARTILE,function(e){return t._stateMachine.adthirdquartile(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.CLICK,function(e){return t._stateMachine.adclicked(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPED,function(e){return t._stateMachine.adskipped(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.COMPLETE,function(e){return t._stateMachine.adcompleted(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(e){return t._stateMachine.adbreakend(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.ALL_ADS_COMPLETED,function(e){return t._stateMachine.alladscompleted(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.USER_CLOSE,function(e){return t._stateMachine.userclosedad(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_CHANGED,function(e){return t._stateMachine.advolumechanged(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_MUTED,function(e){return t._stateMachine.admuted(e)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOG,function(e){return t._stateMachine.aderror(e)}),this._adsManager.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR,function(e){return t._stateMachine.aderror(e)})}},{key:"_syncPlayerVolume",value:function(){this._adsManager&&(this.player.muted?this._adsManager.setVolume(0):this._adsManager.setVolume(this.player.volume))}},{key:"_startAdInterval",value:function(){var t=this;this._stopAdInterval(),this._intervalTimer=setInterval(function(){if(t._stateMachine.is(p.default.PLAYING)){var e=t._adsManager.getRemainingTime(),n=t._adsManager.getCurrentAd().getDuration(),i=n-e;g.Utils.Number.isNumber(n)&&g.Utils.Number.isNumber(i)&&t.dispatchEvent(t.player.Event.AD_PROGRESS,{adProgress:{currentTime:i,duration:n}})}},300)}},{key:"_stopAdInterval",value:function(){this._intervalTimer&&(clearInterval(this._intervalTimer),this._intervalTimer=null)}},{key:"_maybePreloadContent",value:function(){this.player.src||this._adsManager.isCustomPlaybackUsed()||(this.logger.debug("Preloading content"),this.player.load())}},{key:"_resolveNextPromise",value:function(){this._nextPromise&&(this._nextPromise.resolve(),this._nextPromise=null)}},{key:"_maybeDisplayCompanionAds",value:function(t){if(this.config.companions&&!window.googletag)for(var e=Object.keys(this.config.companions),n=0;n<e.length;n++){var i=e[n],s=this.config.companions[i].width,r=this.config.companions[i].height,a=this.config.companions[i].sizeCriteria||"",o=[];try{var d=new this._sdk.CompanionAdSelectionSettings;switch(d.resourceType=this._sdk.CompanionAdSelectionSettings.ResourceType.ALL,d.creativeType=this._sdk.CompanionAdSelectionSettings.CreativeType.ALL,a.toLowerCase()){case"selectnearmatch":d.sizeCriteria=this._sdk.CompanionAdSelectionSettings.SizeCriteria.SELECT_NEAR_MATCH;break;case"ignore":d.sizeCriteria=this._sdk.CompanionAdSelectionSettings.SizeCriteria.IGNORE;break;case"selectexactmatch":default:d.sizeCriteria=this._sdk.CompanionAdSelectionSettings.SizeCriteria.SELECT_EXACT_MATCH}if(o=t.getCompanionAds(s,r,d),o.length>0){var u=o[0],l=u.getContent(),h=g.Utils.Dom.getElementById(i);h&&(h.innerHTML=l)}}catch(t){this.logger.error(t)}}}}]),e}(g.BasePlugin);_.defaultConfig={debug:!1,companions:{},adsRenderingSettings:{enablePreloading:!1,useStyledLinearAds:!1,useStyledNonLinearAds:!1,bitrate:-1,autoAlign:!0}},_.IMA_SDK_LIB_URL="//imasdk.googleapis.com/js/sdkloader/ima3.js",_.IMA_SDK_DEBUG_LIB_URL="//imasdk.googleapis.com/js/sdkloader/ima3_debug.js",e.default=_,(0,g.registerPlugin)("ima",_)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(1),d=n(0),u=function(t){return t&&t.__esModule?t:{default:t}}(d),l=function(t){function e(t){i(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.id="ImaMiddleware",n._context=t,n}return r(e,t),a(e,[{key:"play",value:function(t){var e=this;this._context.loadPromise.then(function(){switch(e._context.getStateMachine().state){case u.default.LOADED:e._context.initialUserAction().then(function(){e.callNext(t)});break;case u.default.PAUSED:e._context.resumeAd().then(function(){e.callNext(t)});break;default:e.callNext(t)}}).catch(function(n){e._context.destroy(),e._context.logger.error(n),e.callNext(t)})}},{key:"pause",value:function(t){switch(this._context.getStateMachine().state){case u.default.PLAYING:this._context.pauseAd();break;default:this.callNext(t)}}}]),e}(o.BaseMiddleware);e.default=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){this.logger.debug(e.type.toUpperCase()),this.dispatchEvent(t.transition,y(e))}function a(t,e){this.logger.debug(e.type.toUpperCase());var n=e.getAd();this._resizeAd(),this._maybeDisplayCompanionAds(n),n.isLinear()?this._startAdInterval():(this._setVideoEndedCallbackEnabled(!0),this._nextPromise?this._resolveNextPromise():this.player.play()),this.dispatchEvent(t.transition),this._maybePreloadContent()}function o(t,e){this.logger.debug(e.type.toUpperCase()),this._stateMachine.is(T.default.PLAYING)?this.pauseAd():this.resumeAd(),this.dispatchEvent(t.transition)}function d(t,e){this.logger.debug(e.type.toUpperCase()),this._nextPromise&&this._resolveNextPromise(),this.dispatchEvent(t.transition)}function u(t,e){this.logger.debug(e.type.toUpperCase()),e.getAd().isLinear()&&this._stopAdInterval(),this.dispatchEvent(t.transition)}function l(t,e){this.logger.debug(e.type.toUpperCase()),c.call(this,t,e),this.destroy()}function h(t,e){this.logger.debug(e.type.toUpperCase()),this._showAdsContainer(),this.player.pause(),this._setVideoEndedCallbackEnabled(!1),this._maybeSaveVideoCurrentTime(),this.dispatchEvent(t.transition)}function c(t,e){this.logger.debug(e.type.toUpperCase()),this._setVideoEndedCallbackEnabled(!0),this._contentComplete||(this._hideAdsContainer(),this._maybeSetVideoCurrentTime(),this._nextPromise?this._resolveNextPromise():this.player.play()),this.dispatchEvent(t.transition)}function f(t,e){if("adError"===e.type){this.logger.debug(e.type.toUpperCase());var n=e.getError();this.loadPromise&&this.loadPromise.reject(n),this._nextPromise&&this._nextPromise.reject(n),this.dispatchEvent(t.transition,v(n,!0))}else{this.logger.debug(e.type.toUpperCase());var i=e.getAdData(),s=i.adError;i.adError&&(this.logger.error("Non-fatal error occurred: "+s.getMessage()),this.dispatchEvent(this.player.Event.AD_ERROR,v(s,!1)))}}function p(t,e){this.logger.debug(e.type.toUpperCase()),this._stopAdInterval(),this.dispatchEvent(t.transition)}function g(t,e){this.logger.debug(e.type.toUpperCase()),this.dispatchEvent(t.transition)}function _(t){t.from!==t.to&&this.logger.debug("Change state: "+t.from+" => "+t.to)}function v(t,e){return{fatal:e,error:{code:t.getErrorCode(),message:t.getMessage()}}}function y(t){return{ad:t.getAd(),extraAdData:t.getAdData()}}Object.defineProperty(e,"__esModule",{value:!0});var m=n(5),E=i(m),A=n(6),b=i(A),L=n(0),T=i(L),M=function t(e){return s(this,t),new E.default({init:T.default.LOADING,transitions:[{name:"loaded",from:[T.default.LOADING,T.default.IDLE,T.default.DONE],to:T.default.LOADED},{name:e.player.Event.AD_STARTED,from:[T.default.LOADED,T.default.IDLE,T.default.PAUSED],to:function(t){return t.getAd().isLinear()?T.default.PLAYING:T.default.IDLE}},{name:e.player.Event.AD_RESUMED,from:T.default.PAUSED,to:T.default.PLAYING},{name:e.player.Event.AD_PAUSED,from:T.default.PLAYING,to:T.default.PAUSED},{name:e.player.Event.AD_SKIPPED,from:[T.default.PLAYING,T.default.PAUSED],to:T.default.IDLE},{name:e.player.Event.AD_COMPLETED,from:T.default.PLAYING,to:T.default.IDLE},{name:e.player.Event.ALL_ADS_COMPLETED,from:T.default.IDLE,to:T.default.DONE},{name:e.player.Event.AD_BREAK_END,from:[T.default.IDLE,T.default.LOADED],to:T.default.IDLE},{name:e.player.Event.AD_ERROR,from:[T.default.LOADED,T.default.PLAYING,T.default.PAUSED,T.default.LOADING],to:T.default.IDLE},{name:e.player.Event.AD_LOADED,from:[T.default.IDLE,T.default.LOADED]},{name:e.player.Event.AD_FIRST_QUARTILE,from:T.default.PLAYING},{name:e.player.Event.AD_BREAK_START,from:[T.default.IDLE,T.default.LOADED]},{name:e.player.Event.AD_MIDPOINT,from:T.default.PLAYING},{name:e.player.Event.AD_THIRD_QUARTILE,from:T.default.PLAYING},{name:e.player.Event.USER_CLOSED_AD,from:[T.default.IDLE,T.default.PLAYING,T.default.PAUSED]},{name:e.player.Event.AD_VOLUME_CHANGED,from:[T.default.PLAYING,T.default.PAUSED,T.default.LOADED]},{name:e.player.Event.AD_MUTED,from:[T.default.PLAYING,T.default.PAUSED,T.default.LOADED]},{name:e.player.Event.AD_CLICKED,from:[T.default.PLAYING,T.default.PAUSED]}],methods:{onAdloaded:r.bind(e),onAdstarted:a.bind(e),onAdpaused:d.bind(e),onAdresumed:g.bind(e),onAdclicked:o.bind(e),onAdskipped:p.bind(e),onAdcompleted:u.bind(e),onAlladscompleted:l.bind(e),onAdbreakstart:h.bind(e),onAdbreakend:c.bind(e),onAdfirstquartile:g.bind(e),onAdmidpoint:g.bind(e),onAdthirdquartile:g.bind(e),onAderror:f.bind(e),onUserclosedad:g.bind(e),onAdvolumechanged:g.bind(e),onAdmuted:g.bind(e),onEnterState:_.bind(e)},plugins:[new b.default]})};e.default=M},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";t.exports=function(t,e){var n,i,s;for(n=1;n<arguments.length;n++){i=arguments[n];for(s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}return t}},function(t,e,n){"use strict";var i=n(0);t.exports={build:function(t,e){var n,s,r,a=e.plugins;for(n=0,s=a.length;n<s;n++)r=a[n],r.methods&&i(t,r.methods),r.properties&&Object.defineProperties(t,r.properties)},hook:function(t,e,n){var i,s,r,a,o=t.config.plugins,d=[t.context];for(n&&(d=d.concat(n)),i=0,s=o.length;i<s;i++)a=o[i],(r=o[i][e])&&r.apply(a,d)}}},function(t,e,n){"use strict";function i(t){if(0===t.length)return t;var e,n,i=t.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return t;for(n=i[0].toLowerCase(),e=1;e<i.length;e++)n=n+i[e].charAt(0).toUpperCase()+i[e].substring(1).toLowerCase();return n}i.prepended=function(t,e){return e=i(e),t+e[0].toUpperCase()+e.substring(1)},t.exports=i},function(t,e,n){"use strict";function i(t,e){t=t||{},this.options=t,this.defaults=e.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(t.init),this.data=this.configureData(t.data),this.methods=this.configureMethods(t.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(t.transitions||[]),this.plugins=this.configurePlugins(t.plugins,e.plugin)}var s=n(0),r=n(2);s(i.prototype,{addState:function(t){this.map[t]||(this.states.push(t),this.addStateLifecycleNames(t),this.map[t]={})},addStateLifecycleNames:function(t){this.lifecycle.onEnter[t]=r.prepended("onEnter",t),this.lifecycle.onLeave[t]=r.prepended("onLeave",t),this.lifecycle.on[t]=r.prepended("on",t)},addTransition:function(t){this.transitions.indexOf(t)<0&&(this.transitions.push(t),this.addTransitionLifecycleNames(t))},addTransitionLifecycleNames:function(t){this.lifecycle.onBefore[t]=r.prepended("onBefore",t),this.lifecycle.onAfter[t]=r.prepended("onAfter",t),this.lifecycle.on[t]=r.prepended("on",t)},mapTransition:function(t){var e=t.name,n=t.from,i=t.to;return this.addState(n),"function"!=typeof i&&this.addState(i),this.addTransition(e),this.map[n][e]=t,t},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(t){return"string"==typeof t?this.mapTransition(s({},this.defaults.init,{to:t,active:!0})):"object"==typeof t?this.mapTransition(s({},this.defaults.init,t,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(t){return"function"==typeof t?t:"object"==typeof t?function(){return t}:function(){return{}}},configureMethods:function(t){return t||{}},configurePlugins:function(t,e){t=t||[];var n,i,s;for(n=0,i=t.length;n<i;n++)s=t[n],"function"==typeof s&&(t[n]=s=s()),s.configure&&s.configure(this);return t},configureTransitions:function(t){var e,n,i,s,r,a=this.defaults.wildcard;for(n=0;n<t.length;n++)for(i=t[n],s=Array.isArray(i.from)?i.from:[i.from||a],r=i.to||a,e=0;e<s.length;e++)this.mapTransition({name:i.name,from:s[e],to:r})},transitionFor:function(t,e){var n=this.defaults.wildcard;return this.map[t][e]||this.map[n][e]},transitionsFor:function(t){var e=this.defaults.wildcard;return Object.keys(this.map[t]).concat(Object.keys(this.map[e]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),t.exports=i},function(t,e,n){function i(t,e){this.context=t,this.config=e,this.state=e.init.from,this.observers=[t]}var s=n(0),r=n(6),a=n(1),o=[null,[]];s(i.prototype,{init:function(t){if(s(this.context,this.config.data.apply(this.context,t)),a.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(t){return Array.isArray(t)?t.indexOf(this.state)>=0:this.state===t},isPending:function(){return this.pending},can:function(t){return!this.isPending()&&!!this.seek(t)},cannot:function(t){return!this.can(t)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(t,e){var n=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,t),s=i&&i.to;return"function"==typeof s?s.apply(this.context,e):s===n?this.state:s},fire:function(t,e){return this.transit(t,this.state,this.seek(t,e),e)},transit:function(t,e,n,i){var s=this.config.lifecycle,r=this.config.options.observeUnchangedState||e!==n;return n?this.isPending()?this.context.onPendingTransition(t,e,n):(this.config.addState(n),this.beginTransit(),i.unshift({transition:t,from:e,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(s.onBefore.transition),this.observersForEvent(s.onBefore[t]),r?this.observersForEvent(s.onLeave.state):o,r?this.observersForEvent(s.onLeave[e]):o,this.observersForEvent(s.on.transition),r?["doTransit",[this]]:o,r?this.observersForEvent(s.onEnter.state):o,r?this.observersForEvent(s.onEnter[n]):o,r?this.observersForEvent(s.on[n]):o,this.observersForEvent(s.onAfter.transition),this.observersForEvent(s.onAfter[t]),this.observersForEvent(s.on[t])],i)):this.context.onInvalidTransition(t,e,n)},beginTransit:function(){this.pending=!0},endTransit:function(t){return this.pending=!1,t},failTransit:function(t){throw this.pending=!1,t},doTransit:function(t){this.state=t.to},observe:function(t){if(2===t.length){var e={};e[t[0]]=t[1],this.observers.push(e)}else this.observers.push(t[0])},observersForEvent:function(t){for(var e,n=0,i=this.observers.length,s=[];n<i;n++)e=this.observers[n],e[t]&&s.push(e);return[t,s,!0]},observeEvents:function(t,e,n,i){if(0===t.length)return this.endTransit(void 0===i||i);var s=t[0][0],r=t[0][1],o=t[0][2];if(e[0].event=s,s&&o&&s!==n&&a.hook(this,"lifecycle",e),0===r.length)return t.shift(),this.observeEvents(t,e,s,i);var d=r.shift(),u=d[s].apply(d,e);return u&&"function"==typeof u.then?u.then(this.observeEvents.bind(this,t,e,s)).catch(this.failTransit.bind(this)):!1===u?this.endTransit(!1):this.observeEvents(t,e,s,u)},onInvalidTransition:function(t,e,n){throw new r("transition is invalid in current state",t,e,n,this.state)},onPendingTransition:function(t,e,n){throw new r("transition is invalid while previous transition is still in progress",t,e,n,this.state)}}),t.exports=i},function(t,e,n){"use strict";function i(t){return r(this||{},t)}function s(){var t,e;"function"==typeof arguments[0]?(t=arguments[0],e=arguments[1]||{}):(t=function(){this._fsm.apply(this,arguments)},e=arguments[0]||{});var n=new l(e,i);return a(t.prototype,n),t.prototype._fsm.config=n,t}function r(t,e){return a(t,new l(e,i)),t._fsm(),t}function a(t,e){if("object"!=typeof t||Array.isArray(t))throw Error("StateMachine can only be applied to objects");u.build(t,e),Object.defineProperties(t,f),o(t,c),o(t,e.methods),e.allTransitions().forEach(function(e){t[d(e)]=function(){return this._fsm.fire(e,[].slice.call(arguments))}}),t._fsm=function(){this._fsm=new h(this,e),this._fsm.init(arguments)}}var o=n(0),d=n(2),u=n(1),l=n(3),h=n(4),c={is:function(t){return this._fsm.is(t)},can:function(t){return this._fsm.can(t)},cannot:function(t){return this._fsm.cannot(t)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(t,e,n){return this._fsm.onInvalidTransition(t,e,n)},onPendingTransition:function(t,e,n){return this._fsm.onPendingTransition(t,e,n)}},f={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(t){throw Error("use transitions to change state")}}};i.version="3.0.1",i.factory=s,i.apply=r,i.defaults={wildcard:"*",init:{name:"init",from:"none"}},t.exports=i},function(t,e,n){"use strict";t.exports=function(t,e,n,i,s){this.message=t,this.transition=e,this.from=n,this.to=i,this.current=s}}])})},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";function i(t){if(0===t.length)return t;var e,n,i=t.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return t;for(n=i[0].toLowerCase(),e=1;e<i.length;e++)n=n+i[e].charAt(0).toUpperCase()+i[e].substring(1).toLowerCase();return n}i.prepended=function(t,e){return e=i(e),t+e[0].toUpperCase()+e.substring(1)},t.exports=i},function(t,e,n){"use strict";var i=n(0);t.exports=function(t){t=t||{};var e=i(t.name||t.past||"history"),n=i(t.future||"future"),s=i.prepended("clear",e),r=i.prepended(e,"back"),a=i.prepended(e,"forward"),o=i.prepended("can",r),d=i.prepended("can",a),u=t.max,l={configure:function(t){t.addTransitionLifecycleNames(r),t.addTransitionLifecycleNames(a)},init:function(t){t[e]=[],t[n]=[]},lifecycle:function(t,i){"onEnterState"===i.event&&(t[e].push(i.to),u&&t[e].length>u&&t[e].shift(),i.transition!==r&&i.transition!==a&&(t[n].length=0))},methods:{},properties:{}};return l.methods[s]=function(){this[e].length=0,this[n].length=0},l.properties[o]={get:function(){return this[e].length>1}},l.properties[d]={get:function(){return this[n].length>0}},l.methods[r]=function(){if(!this[o])throw Error("no history");var t=this[e].pop(),i=this[e].pop();this[n].push(t),this._fsm.transit(r,t,i,[])},l.methods[a]=function(){if(!this[d])throw Error("no history");var t=this.state,e=this[n].pop();this._fsm.transit(a,t,e,[])},l}}])})}])});
//# sourceMappingURL=playkit-ima.min.js.map