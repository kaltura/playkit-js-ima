!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("playkit-js")):"function"==typeof define&&define.amd?define(["playkit-js"],t):"object"==typeof exports?exports.PlaykitJsIma=t(require("playkit-js")):e.PlaykitJsIma=t(e.Playkit)}(this,function(e){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={LOADING:"loading",LOADED:"loaded",PLAYING:"playing",PAUSED:"paused",IDLE:"idle",DONE:"done"};t.default=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d=n(3),u=i(d),l=n(4),h=i(l),c=n(0),f=i(c),p=n(2),g=function(e){function t(e,n,i){s(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return a._stateMachine=new h.default(a),a._initMembers(),a._addBindings(),a._init(),a}return a(t,e),o(t,null,[{key:"isValid",value:function(){return!0}}]),o(t,[{key:"playAdNow",value:function(e){this.logger.warn("playAdNow API is not implemented yet",e)}},{key:"skipAd",value:function(){this.logger.debug("Skip ad"),this._adsManager&&(this._adsManager.getAdSkippableState()?this._adsManager.skip():this.config.skipSupport&&this._adsManager.stop())}},{key:"resumeAd",value:function(){return this.logger.debug("Resume ad"),this._nextPromise=p.Utils.Object.defer(),this._adsManager.resume(),this._nextPromise}},{key:"pauseAd",value:function(){return this.logger.debug("Pause ad"),this._nextPromise=p.Utils.Object.defer(),this._adsManager.pause(),this._nextPromise}},{key:"getStateMachine",value:function(){return this._stateMachine}},{key:"getMiddlewareImpl",value:function(){return new u.default(this)}},{key:"reset",value:function(){this.logger.debug("reset"),this.eventManager.removeAll(),this._stopAdInterval(),this._hideAdsContainer(),this._adsManager&&this._adsManager.destroy(),this._adsLoader&&!this._contentComplete&&this._adsLoader.contentComplete(),this._initMembers(),this._addBindings(),this._adsLoader||this._initAdsLoader(),this._requestAds(),this._stateMachine.loaded()}},{key:"destroy",value:function(){this.logger.debug("destroy"),this.eventManager.destroy(),this._stopAdInterval(),this._hideAdsContainer(),this._adsManager&&this._adsManager.destroy(),this._adsLoader&&!this._contentComplete&&this._adsLoader.contentComplete(),this._adsLoader=null,this._initMembers()}},{key:"initialUserAction",value:function(){try{this.logger.debug("Initial user action"),this._nextPromise=p.Utils.Object.defer(),this._adDisplayContainer.initialize(),this._hasUserAction=!0,this._isAdsManagerLoaded&&(this.logger.debug("User action occurred after ads manager loaded"),this._startAdsManager())}catch(e){this.logger.error(e),this.destroy()}return this._nextPromise}},{key:"_startAdsManager",value:function(){var e=this._getPlayerViewSize();this.logger.debug("Start ads manager"),this._adsManager.init(e.width,e.height,this._sdk.ViewMode.NORMAL),this._adsManager.start()}},{key:"_addBindings",value:function(){var e=this;["fullscreenchange","mozfullscreenchange","webkitfullscreenchange"].forEach(function(t){return e.eventManager.listen(document,t,e._resizeAd.bind(e))}),this.eventManager.listen(window,"resize",this._resizeAd.bind(this)),this.eventManager.listen(this.player,this.player.Event.VOLUME_CHANGE,this._syncPlayerVolume.bind(this)),this.eventManager.listen(this.player,this.player.Event.SOURCE_SELECTED,function(t){var n=t.payload.selectedSource;n&&n.length>0&&(e._contentSrc=n[0].url)})}},{key:"_initMembers",value:function(){this._setTogglePlayPauseOnAdsContainerEnabled(!1),this._setContentPlayheadTrackerEventsEnabled(!1),this._setVideoEndedCallbackEnabled(!1),this._nextPromise=null,this._currentAd=null,this._adsManager=null,this._contentComplete=!1,this._isAdsManagerLoaded=!1,this._intervalTimer=null,this._videoLastCurrentTime=null,this._contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this._hasUserAction=!1,this._togglePlayPauseOnAdsContainerCallback=null}},{key:"_init",value:function(){var e=this;this.loadPromise=p.Utils.Object.defer(),(this._isImaSDKLibLoaded()?Promise.resolve():p.Utils.Dom.loadScriptAsync(this.config.debug?t.IMA_SDK_DEBUG_LIB_URL:t.IMA_SDK_LIB_URL)).then(function(){e._sdk=window.google.ima,e.logger.debug("IMA SDK version: "+e._sdk.VERSION),e._initImaSettings(),e._initAdsContainer(),e._initAdsLoader(),e._requestAds(),e._stateMachine.loaded(),e.loadPromise.resolve()}).catch(function(t){e.loadPromise.reject(t)})}},{key:"_isImaSDKLibLoaded",value:function(){return window.google&&window.google.ima&&window.google.ima.VERSION}},{key:"_initImaSettings",value:function(){this._sdk.settings.setPlayerType(this.config.playerName),this._sdk.settings.setPlayerVersion(this.config.playerVersion),this._sdk.settings.setVpaidAllowed(!0),this._sdk.settings.setVpaidMode(this._sdk.ImaSdkSettings.VpaidMode.ENABLED)}},{key:"_initAdsContainer",value:function(){this.logger.debug("Init ads container");var e=p.Utils.Dom.getElementById("playkit-ads-container");if(e)this._adsContainerDiv=e;else{var t=this.player.getView();this._adsContainerDiv=p.Utils.Dom.createElement("div"),this._adsContainerDiv.id="playkit-ads-container"+t.id,this._adsContainerDiv.style.position="absolute",this._adsContainerDiv.style.top="0px",p.Utils.Dom.appendChild(t,this._adsContainerDiv)}this._adDisplayContainer=new this._sdk.AdDisplayContainer(this._adsContainerDiv,this.player.getVideoElement())}},{key:"_initAdsLoader",value:function(){var e=this;this.logger.debug("Init ads loader"),this._adsLoader=new this._sdk.AdsLoader(this._adDisplayContainer),this._adsLoader.addEventListener(this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this._onAdsManagerLoaded.bind(this)),this._adsLoader.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR,function(t){return e._stateMachine.aderror(t)})}},{key:"_requestAds",value:function(){if(this.config.adTagUrl||this.config.adsResponse){this.logger.debug("Request ads");var e=new this._sdk.AdsRequest;this.config.adTagUrl?e.adTagUrl=this.config.adTagUrl:e.adsResponse=this.config.adsResponse;var t=this._getPlayerViewSize();e.linearAdSlotWidth=t.width,e.linearAdSlotHeight=t.height,e.nonLinearAdSlotWidth=t.width,e.nonLinearAdSlotHeight=t.height/3,this._adsLoader.requestAds(e)}else this.logger.warn("Missing ad tag url: create plugin without requesting ads")}},{key:"_resizeAd",value:function(){if(this._sdk&&this._adsManager){var e=this._getPlayerViewSize(),t=this._isFullScreen(),n=t?this._sdk.ViewMode.FULLSCREEN:this._sdk.ViewMode.NORMAL;this._adsManager.resize(e.width,e.height,n)}}},{key:"_isFullScreen",value:function(){return void 0!==document.fullscreenElement&&Boolean(document.fullscreenElement)||void 0!==document.webkitFullscreenElement&&Boolean(document.webkitFullscreenElement)||void 0!==document.mozFullScreenElement&&Boolean(document.mozFullScreenElement)||void 0!==document.msFullscreenElement&&Boolean(document.msFullscreenElement)}},{key:"_getPlayerViewSize",value:function(){var e=this.player.getView();return{width:parseInt(getComputedStyle(e).width,10),height:parseInt(getComputedStyle(e).height,10)}}},{key:"_onLoadedMetadata",value:function(){this._contentPlayheadTracker.duration=this.player.duration}},{key:"_onMediaTimeUpdate",value:function(){this._contentPlayheadTracker.seeking||(this._contentPlayheadTracker.previousTime=this._contentPlayheadTracker.currentTime,this._contentPlayheadTracker.currentTime=this.player.currentTime)}},{key:"_setContentPlayheadTrackerEventsEnabled",value:function(e){e?(this.eventManager.listen(this.player,this.player.Event.LOADED_METADATA,this._onLoadedMetadata.bind(this)),this.eventManager.listen(this.player,this.player.Event.TIME_UPDATE,this._onMediaTimeUpdate.bind(this)),this.eventManager.listen(this.player,this.player.Event.SEEKING,this._onMediaSeeking.bind(this)),this.eventManager.listen(this.player,this.player.Event.SEEKED,this._onMediaSeeked.bind(this))):(this.eventManager.unlisten(this.player,this.player.Event.LOADED_METADATA),this.eventManager.unlisten(this.player,this.player.Event.TIME_UPDATE),this.eventManager.unlisten(this.player,this.player.Event.SEEKING),this.eventManager.unlisten(this.player,this.player.Event.SEEKED))}},{key:"_onMediaSeeking",value:function(){this._contentPlayheadTracker.seeking=!0}},{key:"_onMediaSeeked",value:function(){this._contentPlayheadTracker.seeking=!1}},{key:"_setVideoEndedCallbackEnabled",value:function(e){e?this.eventManager.listen(this.player,this.player.Event.ENDED,this._onMediaEnded.bind(this)):this.eventManager.unlisten(this.player,this.player.Event.ENDED)}},{key:"_maybeSaveVideoCurrentTime",value:function(){this._adsManager.isCustomPlaybackUsed()&&this.player.currentTime&&this.player.currentTime>0&&(this.logger.debug("Custom playback used: save current time before ads",this.player.currentTime),this._videoLastCurrentTime=this.player.currentTime)}},{key:"_maybeSetVideoCurrentTime",value:function(){this._videoLastCurrentTime&&(this.logger.debug("Custom playback used: set current time after ads",this._videoLastCurrentTime),this.player.currentTime=this._videoLastCurrentTime,this._videoLastCurrentTime=null)}},{key:"_onMediaEnded",value:function(){this.logger.debug("Media ended"),this._adsLoader.contentComplete(),this._contentComplete=!0,this._currentAd.isLinear()||this.destroy()}},{key:"_showAdsContainer",value:function(){this._adsContainerDiv&&(this._adsContainerDiv.style.display="")}},{key:"_hideAdsContainer",value:function(){this._adsContainerDiv&&(this._adsContainerDiv.style.display="none")}},{key:"_onAdsManagerLoaded",value:function(e){var t=this;this.logger.debug("Ads manager loaded");var n=new this._sdk.AdsRenderingSettings;Object.keys(this.config.adsRenderingSettings).forEach(function(e){null!=n[e]&&(n[e]=t.config.adsRenderingSettings[e])}),this._adsManager=e.getAdsManager(this._contentPlayheadTracker,n),this._isAdsManagerLoaded=!0,this._attachAdsManagerListeners(),this._syncPlayerVolume(),this._hasUserAction&&(this.logger.debug("User action occurred before ads manager loaded"),this._startAdsManager())}},{key:"_attachAdsManagerListeners",value:function(){var e=this;this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(t){return e._stateMachine.adbreakstart(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOADED,function(t){return e._stateMachine.adloaded(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.STARTED,function(t){return e._stateMachine.adstarted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.PAUSED,function(t){return e._stateMachine.adpaused(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.RESUMED,function(t){return e._stateMachine.adresumed(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.FIRST_QUARTILE,function(t){return e._stateMachine.adfirstquartile(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.MIDPOINT,function(t){return e._stateMachine.admidpoint(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.THIRD_QUARTILE,function(t){return e._stateMachine.adthirdquartile(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.CLICK,function(t){return e._stateMachine.adclicked(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPED,function(t){return e._stateMachine.adskipped(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.COMPLETE,function(t){return e._stateMachine.adcompleted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(t){return e._stateMachine.adbreakend(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.ALL_ADS_COMPLETED,function(t){return e._stateMachine.alladscompleted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.USER_CLOSE,function(t){return e._stateMachine.userclosedad(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_CHANGED,function(t){return e._stateMachine.advolumechanged(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_MUTED,function(t){return e._stateMachine.admuted(t)}),this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOG,function(t){return e._stateMachine.aderror(t)}),this._adsManager.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR,function(t){return e._stateMachine.aderror(t)})}},{key:"_syncPlayerVolume",value:function(){this._adsManager&&(this.player.muted?this._adsManager.setVolume(0):this._adsManager.setVolume(this.player.volume))}},{key:"_startAdInterval",value:function(){var e=this;this._stopAdInterval(),this._intervalTimer=setInterval(function(){if(e._stateMachine.is(f.default.PLAYING)){var t=e._adsManager.getRemainingTime(),n=e._adsManager.getCurrentAd().getDuration(),i=n-t;p.Utils.Number.isNumber(n)&&p.Utils.Number.isNumber(i)&&e.dispatchEvent(e.player.Event.AD_PROGRESS,{adProgress:{currentTime:i,duration:n}})}},300)}},{key:"_stopAdInterval",value:function(){this._intervalTimer&&(clearInterval(this._intervalTimer),this._intervalTimer=null)}},{key:"_resolveNextPromise",value:function(){this._nextPromise&&(this._nextPromise.resolve(),this._nextPromise=null)}},{key:"_setTogglePlayPauseOnAdsContainerEnabled",value:function(e){this._adsContainerDiv&&this._togglePlayPauseOnAdsContainerCallback&&(e?this._adsContainerDiv.addEventListener("click",this._togglePlayPauseOnAdsContainerCallback):this._adsContainerDiv.removeEventListener("click",this._togglePlayPauseOnAdsContainerCallback))}},{key:"_onAdsContainerClicked",value:function(){this.player.paused?this.player.play():this.player.pause()}},{key:"_maybeDisplayCompanionAds",value:function(){if(this.config.companions&&!window.googletag)for(var e=Object.keys(this.config.companions),t=0;t<e.length;t++){var n=e[t],i=this.config.companions[n].width,s=this.config.companions[n].height,r=this.config.companions[n].sizeCriteria||"",a=[];try{var o=new this._sdk.CompanionAdSelectionSettings;switch(o.resourceType=this._sdk.CompanionAdSelectionSettings.ResourceType.ALL,o.creativeType=this._sdk.CompanionAdSelectionSettings.CreativeType.ALL,r.toLowerCase()){case"selectnearmatch":o.sizeCriteria=this._sdk.CompanionAdSelectionSettings.SizeCriteria.SELECT_NEAR_MATCH;break;case"ignore":o.sizeCriteria=this._sdk.CompanionAdSelectionSettings.SizeCriteria.IGNORE;break;case"selectexactmatch":default:o.sizeCriteria=this._sdk.CompanionAdSelectionSettings.SizeCriteria.SELECT_EXACT_MATCH}if(a=this._currentAd.getCompanionAds(i,s,o),a.length>0){var d=a[0],u=d.getContent(),l=p.Utils.Dom.getElementById(n);l&&(l.innerHTML=u)}}catch(e){this.logger.error(e)}}}}]),t}(p.BasePlugin);g.defaultConfig={debug:!1,companions:{},adsRenderingSettings:{restoreCustomPlaybackStateOnAdBreakComplete:!0,enablePreloading:!1,useStyledLinearAds:!1,useStyledNonLinearAds:!0,bitrate:-1,autoAlign:!0}},g.IMA_SDK_LIB_URL="//imasdk.googleapis.com/js/sdkloader/ima3.js",g.IMA_SDK_DEBUG_LIB_URL="//imasdk.googleapis.com/js/sdkloader/ima3_debug.js",t.default=g,(0,p.registerPlugin)("ima",g)},function(t,n){t.exports=e},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d=n(2),u=n(1),l=(i(u),n(0)),h=i(l),c=function(e){function t(e){s(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.id="ImaMiddleware",n._context=e,e.player.addEventListener(e.player.Event.CHANGE_SOURCE_STARTED,function(){return n._isPlayerLoaded=!1}),n}return a(t,e),o(t,[{key:"play",value:function(e){var t=this;this._isPlayerLoaded||(this._context.player.load(),this._isPlayerLoaded=!0,this._context.logger.debug("Player loaded")),this._context.loadPromise.then(function(){switch(t._context.getStateMachine().state){case h.default.LOADED:var n=t._context.initialUserAction();n?n.then(function(){t.callNext(e)}):t.callNext(e);break;case h.default.PAUSED:var i=t._context.resumeAd();i?i.then(function(){t.callNext(e)}):t.callNext(e);break;default:t.callNext(e)}}).catch(function(n){t._context.destroy(),t._context.logger.error(n),t.callNext(e)})}},{key:"pause",value:function(e){switch(this._context.getStateMachine().state){case h.default.PLAYING:this._context.pauseAd();break;default:this.callNext(e)}}}]),t}(d.BaseMiddleware);t.default=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){this.logger.debug(t.type.toUpperCase()),this.dispatchEvent(e.transition,y(t))}function a(e,t){this.logger.debug(t.type.toUpperCase()),this._currentAd=t.getAd(),this._resizeAd(),this._showAdsContainer(),this._maybeDisplayCompanionAds(),this._currentAd.isLinear()?(this._setContentPlayheadTrackerEventsEnabled(!1),this._startAdInterval()):(this._setContentPlayheadTrackerEventsEnabled(!0),this._setVideoEndedCallbackEnabled(!0),this._togglePlayPauseOnAdsContainerCallback=this._onAdsContainerClicked.bind(this),this._setTogglePlayPauseOnAdsContainerEnabled(!0),this._nextPromise?this._resolveNextPromise():this.player.play()),this.dispatchEvent(e.transition)}function o(e,t){this.logger.debug(t.type.toUpperCase()),this._currentAd.isLinear()?this._stateMachine.is(k.default.PLAYING)?this.pauseAd():this._stateMachine.is(k.default.PAUSED)&&this.resumeAd():this.player.paused||this.player.pause(),this.dispatchEvent(e.transition)}function d(e,t){this.logger.debug(t.type.toUpperCase()),this.dispatchEvent(e.transition)}function u(e,t){this.logger.debug(t.type.toUpperCase()),this._currentAd.isLinear()&&this._stopAdInterval(),this._currentAd=null,this.dispatchEvent(e.transition)}function l(e,t){this.logger.debug(t.type.toUpperCase()),c.call(this,e,t),this._adsManager.isCustomPlaybackUsed()&&this._contentComplete&&(this.player.getVideoElement().src=this._contentSrc),this.destroy()}function h(e,t){this.logger.debug(t.type.toUpperCase()),this.player.pause(),this._setVideoEndedCallbackEnabled(!1),this._maybeSaveVideoCurrentTime(),this.dispatchEvent(e.transition)}function c(e,t){this.logger.debug(t.type.toUpperCase()),this._setVideoEndedCallbackEnabled(!0),this._setContentPlayheadTrackerEventsEnabled(!0),this._contentComplete||(this._hideAdsContainer(),this._maybeSetVideoCurrentTime(),this._nextPromise?this._resolveNextPromise():this.player.play()),this.dispatchEvent(e.transition)}function f(e,t){if("adError"===t.type){this.logger.debug(t.type.toUpperCase());var n=t.getError();this.loadPromise&&this.loadPromise.reject(n),this._nextPromise&&this._nextPromise.reject(n),this.dispatchEvent(e.transition,v(n,!0))}else{this.logger.debug(t.type.toUpperCase());var i=t.getAdData(),s=i.adError;i.adError&&(this.logger.error("Non-fatal error occurred: "+s.getMessage()),this.dispatchEvent(this.player.Event.AD_ERROR,v(s,!1)))}}function p(e,t){this.logger.debug(t.type.toUpperCase()),this._stopAdInterval(),this.dispatchEvent(e.transition)}function g(e,t){this.logger.debug(t.type.toUpperCase()),this.dispatchEvent(e.transition)}function _(e){e.from!==e.to&&this.logger.debug("Change state: "+e.from+" => "+e.to)}function v(e,t){return{fatal:t,error:{code:e.getErrorCode(),message:e.getMessage()}}}function y(e){return{ad:e.getAd(),extraAdData:e.getAdData()}}Object.defineProperty(t,"__esModule",{value:!0});var E=n(5),m=i(E),A=n(6),b=i(A),L=n(0),k=i(L),M=function e(t){return s(this,e),new m.default({init:k.default.LOADING,transitions:[{name:"loaded",from:[k.default.LOADING,k.default.LOADED,k.default.IDLE,k.default.PAUSED,k.default.PLAYING,k.default.DONE],to:k.default.LOADED},{name:t.player.Event.AD_STARTED,from:[k.default.LOADED,k.default.IDLE,k.default.PAUSED],to:function(e){return e.getAd().isLinear()?k.default.PLAYING:k.default.IDLE}},{name:t.player.Event.AD_RESUMED,from:k.default.PAUSED,to:k.default.PLAYING},{name:t.player.Event.AD_PAUSED,from:k.default.PLAYING,to:k.default.PAUSED},{name:t.player.Event.AD_SKIPPED,from:[k.default.PLAYING,k.default.PAUSED],to:k.default.IDLE},{name:t.player.Event.AD_COMPLETED,from:k.default.PLAYING,to:k.default.IDLE},{name:t.player.Event.ALL_ADS_COMPLETED,from:k.default.IDLE,to:k.default.DONE},{name:t.player.Event.AD_BREAK_END,from:[k.default.IDLE,k.default.LOADED],to:k.default.IDLE},{name:t.player.Event.AD_ERROR,from:[k.default.LOADED,k.default.PLAYING,k.default.PAUSED,k.default.LOADING],to:k.default.IDLE},{name:t.player.Event.AD_LOADED,from:[k.default.IDLE,k.default.LOADED]},{name:t.player.Event.AD_FIRST_QUARTILE,from:k.default.PLAYING},{name:t.player.Event.AD_BREAK_START,from:[k.default.IDLE,k.default.LOADED]},{name:t.player.Event.AD_MIDPOINT,from:k.default.PLAYING},{name:t.player.Event.AD_THIRD_QUARTILE,from:k.default.PLAYING},{name:t.player.Event.USER_CLOSED_AD,from:[k.default.IDLE,k.default.PLAYING,k.default.PAUSED]},{name:t.player.Event.AD_VOLUME_CHANGED,from:[k.default.PLAYING,k.default.PAUSED,k.default.LOADED]},{name:t.player.Event.AD_MUTED,from:[k.default.PLAYING,k.default.PAUSED,k.default.LOADED]},{name:t.player.Event.AD_CLICKED,from:[k.default.PLAYING,k.default.PAUSED,k.default.IDLE]}],methods:{onAdloaded:r.bind(t),onAdstarted:a.bind(t),onAdpaused:d.bind(t),onAdresumed:g.bind(t),onAdclicked:o.bind(t),onAdskipped:p.bind(t),onAdcompleted:u.bind(t),onAlladscompleted:l.bind(t),onAdbreakstart:h.bind(t),onAdbreakend:c.bind(t),onAdfirstquartile:g.bind(t),onAdmidpoint:g.bind(t),onAdthirdquartile:g.bind(t),onAderror:f.bind(t),onUserclosedad:g.bind(t),onAdvolumechanged:g.bind(t),onAdmuted:g.bind(t),onEnterState:_.bind(t)},plugins:[new b.default]})};t.default=M},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){"use strict";e.exports=function(e,t){var n,i,s;for(n=1;n<arguments.length;n++){i=arguments[n];for(s in i)i.hasOwnProperty(s)&&(e[s]=i[s])}return e}},function(e,t,n){"use strict";var i=n(0);e.exports={build:function(e,t){var n,s,r,a=t.plugins;for(n=0,s=a.length;n<s;n++)r=a[n],r.methods&&i(e,r.methods),r.properties&&Object.defineProperties(e,r.properties)},hook:function(e,t,n){var i,s,r,a,o=e.config.plugins,d=[e.context];for(n&&(d=d.concat(n)),i=0,s=o.length;i<s;i++)a=o[i],(r=o[i][t])&&r.apply(a,d)}}},function(e,t,n){"use strict";function i(e){if(0===e.length)return e;var t,n,i=e.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return e;for(n=i[0].toLowerCase(),t=1;t<i.length;t++)n=n+i[t].charAt(0).toUpperCase()+i[t].substring(1).toLowerCase();return n}i.prepended=function(e,t){return t=i(t),e+t[0].toUpperCase()+t.substring(1)},e.exports=i},function(e,t,n){"use strict";function i(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}var s=n(0),r=n(2);s(i.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=r.prepended("onEnter",e),this.lifecycle.onLeave[e]=r.prepended("onLeave",e),this.lifecycle.on[e]=r.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=r.prepended("onBefore",e),this.lifecycle.onAfter[e]=r.prepended("onAfter",e),this.lifecycle.on[e]=r.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,i=e.to;return this.addState(n),"function"!=typeof i&&this.addState(i),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(s({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(s({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){e=e||[];var n,i,s;for(n=0,i=e.length;n<i;n++)s=e[n],"function"==typeof s&&(e[n]=s=s()),s.configure&&s.configure(this);return e},configureTransitions:function(e){var t,n,i,s,r,a=this.defaults.wildcard;for(n=0;n<e.length;n++)for(i=e[n],s=Array.isArray(i.from)?i.from:[i.from||a],r=i.to||a,t=0;t<s.length;t++)this.mapTransition({name:i.name,from:s[t],to:r})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=i},function(e,t,n){function i(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}var s=n(0),r=n(6),a=n(1),o=[null,[]];s(i.prototype,{init:function(e){if(s(this.context,this.config.data.apply(this.context,e)),a.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,e),s=i&&i.to;return"function"==typeof s?s.apply(this.context,t):s===n?this.state:s},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,i){var s=this.config.lifecycle,r=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),i.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(s.onBefore.transition),this.observersForEvent(s.onBefore[e]),r?this.observersForEvent(s.onLeave.state):o,r?this.observersForEvent(s.onLeave[t]):o,this.observersForEvent(s.on.transition),r?["doTransit",[this]]:o,r?this.observersForEvent(s.onEnter.state):o,r?this.observersForEvent(s.onEnter[n]):o,r?this.observersForEvent(s.on[n]):o,this.observersForEvent(s.onAfter.transition),this.observersForEvent(s.onAfter[e]),this.observersForEvent(s.on[e])],i)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,i=this.observers.length,s=[];n<i;n++)t=this.observers[n],t[e]&&s.push(t);return[e,s,!0]},observeEvents:function(e,t,n,i){if(0===e.length)return this.endTransit(void 0===i||i);var s=e[0][0],r=e[0][1],o=e[0][2];if(t[0].event=s,s&&o&&s!==n&&a.hook(this,"lifecycle",t),0===r.length)return e.shift(),this.observeEvents(e,t,s,i);var d=r.shift(),u=d[s].apply(d,t);return u&&"function"==typeof u.then?u.then(this.observeEvents.bind(this,e,t,s)).catch(this.failTransit.bind(this)):!1===u?this.endTransit(!1):this.observeEvents(e,t,s,u)},onInvalidTransition:function(e,t,n){throw new r("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new r("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=i},function(e,t,n){"use strict";function i(e){return r(this||{},e)}function s(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new l(t,i);return a(e.prototype,n),e.prototype._fsm.config=n,e}function r(e,t){return a(e,new l(t,i)),e._fsm(),e}function a(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");u.build(e,t),Object.defineProperties(e,f),o(e,c),o(e,t.methods),t.allTransitions().forEach(function(t){e[d(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new h(this,t),this._fsm.init(arguments)}}var o=n(0),d=n(2),u=n(1),l=n(3),h=n(4),c={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},f={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};i.version="3.0.1",i.factory=s,i.apply=r,i.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=i},function(e,t,n){"use strict";e.exports=function(e,t,n,i,s){this.message=e,this.transition=t,this.from=n,this.to=i,this.current=s}}])})},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function i(e){if(0===e.length)return e;var t,n,i=e.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return e;for(n=i[0].toLowerCase(),t=1;t<i.length;t++)n=n+i[t].charAt(0).toUpperCase()+i[t].substring(1).toLowerCase();return n}i.prepended=function(e,t){return t=i(t),e+t[0].toUpperCase()+t.substring(1)},e.exports=i},function(e,t,n){"use strict";var i=n(0);e.exports=function(e){e=e||{};var t=i(e.name||e.past||"history"),n=i(e.future||"future"),s=i.prepended("clear",t),r=i.prepended(t,"back"),a=i.prepended(t,"forward"),o=i.prepended("can",r),d=i.prepended("can",a),u=e.max,l={configure:function(e){e.addTransitionLifecycleNames(r),e.addTransitionLifecycleNames(a)},init:function(e){e[t]=[],e[n]=[]},lifecycle:function(e,i){"onEnterState"===i.event&&(e[t].push(i.to),u&&e[t].length>u&&e[t].shift(),i.transition!==r&&i.transition!==a&&(e[n].length=0))},methods:{},properties:{}};return l.methods[s]=function(){this[t].length=0,this[n].length=0},l.properties[o]={get:function(){return this[t].length>1}},l.properties[d]={get:function(){return this[n].length>0}},l.methods[r]=function(){if(!this[o])throw Error("no history");var e=this[t].pop(),i=this[t].pop();this[n].push(e),this._fsm.transit(r,e,i,[])},l.methods[a]=function(){if(!this[d])throw Error("no history");var e=this.state,t=this[n].pop();this._fsm.transit(a,e,t,[])},l}}])})}])});
//# sourceMappingURL=playkit-ima.min.js.map